{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KQ Bookings Quality Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'js/dashboard.js' %}"></script>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">


</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <img src="{% static 'images/kq-logo.png' %}" alt="KQ Logo" class="logo-img">
                KQ Bookings Quality Report
            </div>
            <div class="theme-switcher">
                <div class="theme-btn default active" data-theme="default" title="Default Theme"></div>
                <div class="theme-btn dark" data-theme="dark" title="Dark Theme"></div>
            </div>
        </div>
    </div>

    <div class="filters">
        <div class="filter-group">
            <label>Booking Date Range</label>
            <div class="date-picker-container">
                <input type="text" id="booking_date_display" placeholder="start-date → end-date" readonly class="date-display">
                <div id="booking_date_picker" class="date-picker">
                    <div class="date-input-group">
                        <label class="date-label">Start Date:</label>
                        <input type="date" id="booking_start_date" value="{{ request.GET.start_date }}" onchange="updateBookingDateDisplay()" class="date-input">
                    </div>
                    <div class="date-input-group">
                        <label class="date-label">End Date:</label>
                        <input type="date" id="booking_end_date" value="{{ request.GET.end_date }}" onchange="updateBookingDateDisplay()" class="date-input">
                    </div>
                    <div class="date-buttons">
                        <button type="button" id="clear-booking-dates-btn" class="date-btn date-btn-clear">Clear</button>
                        <button type="button" id="done-booking-dates-btn" class="date-btn date-btn-done">Done</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="filter-group delivery-system-filter">
            <label>Delivery System</label>
            <div id="delivery-system-filter-toggle">
                <input type="text" placeholder="All" readonly class="filter-input">
                <div class="delivery-system-dropdown" id="delivery-system-dropdown">
                    <!-- Delivery systems will be populated by JavaScript -->
                </div>
            </div>
            <div class="delivery-system-tags" id="delivery-system-tags"></div>
        </div>

        <div class="filter-group office-filter">
            <label>Office</label>
            <div id="office-filter-toggle">
                <input type="text" placeholder="All" readonly class="filter-input" id="office-input">
                <div class="office-dropdown" id="office-dropdown">
                    <input type="text" class="office-search-input" id="office-search-input" placeholder="Search offices..." autocomplete="off">
                    <div class="office-dropdown-content" id="office-dropdown-content">
                        <!-- Offices will be populated here -->
                    </div>
                </div>
            </div>
            <div class="office-tags" id="office-tags"></div>
        </div>
        
        <div class="filter-group">
            <label>Flight Departure Date</label>
            <div class="date-picker-container disabled">
                <input type="text" id="flight_departure_display" placeholder="Not Available" readonly class="date-display disabled">
                <div id="flight_date_picker" class="date-picker">
                    <div class="date-input-group">
                        <label class="date-label">Start Date:</label>
                        <input type="date" id="flight_start_date" value="{{ request.GET.flight_start }}" onchange="updateFlightDateDisplay()" class="date-input">
                    </div>
                    <div class="date-input-group">
                        <label class="date-label">End Date:</label>
                        <input type="date" id="flight_end_date" value="{{ request.GET.flight_end }}" onchange="updateFlightDateDisplay()" class="date-input">
                    </div>
                    <div class="date-buttons">
                        <button type="button" id="clear-flight-dates-btn" class="date-btn date-btn-clear">Clear</button>
                        <button type="button" id="done-flight-dates-btn" class="date-btn date-btn-done">Done</button>
                    </div>
                </div>
            </div>
        </div>

        <button class="filter-btn" id="apply-filters-btn">🔍 Apply Filters</button>
        <button class="filter-btn filter-btn-clear" id="clear-filters-btn">🔄 Clear</button>
    </div>

    <div class="nav-tabs">
        <button class="nav-tab active" data-section="overview">📊 Overview</button>
        <button class="nav-tab" data-section="delivery-systems">🌐 Delivery Systems</button>
        <button class="nav-tab" data-section="elements">📋 Elements</button>
        <button class="nav-tab" data-section="offices">🏢 Offices</button>
        <button class="nav-tab" data-section="quality">📈 Quality</button>
        <button class="nav-tab" id="upload-btn">📁 Upload</button>
    </div>

    <div class="container">
        {% if messages %}
            {% for message in messages %}
                <div class="message {% if message.tags == 'error' %}message-error{% else %}message-success{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <!-- Overview Section -->
        <div id="overview" class="content-section active">
            <div class="enhanced-stats-grid">
                <div class="enhanced-card card-overview clickable-card" data-metric="total_pnrs" tabindex="0" role="article" aria-label="Total PNRs Statistics">
                    <div class="card-header">
                        <div class="card-icon animated-icon info-gradient">📊</div>
                        <div class="card-badge">Primary</div>
                    </div>
                    <div class="card-title">Total Bookings</div>
                    <div class="card-value tooltip" data-tooltip="Total number of PNRs processed">{{ total_pnrs|default:0 }}</div>
                    <div class="card-subtitle">All passenger name records in the system</div>
                    <div class="progress-container">
                        <div class="progress-bar progress-excellent" style="width: 100%;"></div>
                    </div>
                    <div class="card-metric">
                        <span class="metric-label">Processing Status</span>
                        <span class="metric-value">✅ Complete</span>
                    </div>
                </div>

                <div class="enhanced-card card-overview clickable-card" data-metric="reachable_pnrs" tabindex="0" role="article" aria-label="Reachable PNRs Statistics">
                    <div class="card-header">
                        <div class="card-icon animated-icon success-gradient">📞</div>
                        <div class="card-badge">Contact</div>
                    </div>
                    <div class="card-title">Reachable Passengers</div>
                    <div class="card-value tooltip" data-tooltip="PNRs with valid contact information">{{ reachable_pnrs|default:0 }}</div>
                    <div class="card-subtitle">Passengers we can communicate with</div>
                    <div class="progress-container">
                        <div class="progress-bar progress-excellent" style="width: {% widthratio reachable_pnrs total_pnrs 100 %}%;"></div>
                    </div>
                    <div class="card-metric">
                        <span class="metric-label">Reachability Rate</span>
                        <span class="metric-value">{% if total_pnrs %}{% widthratio reachable_pnrs total_pnrs 100 %}%{% else %}0%{% endif %}</span>
                    </div>
                </div>

                <div class="enhanced-card card-overview" tabindex="0" role="article" aria-label="Quality Score Statistics">
                    <div class="card-header">
                        <div class="card-icon animated-icon warning-gradient">⭐</div>
                        <div class="card-badge">Quality</div>
                    </div>
                    <div class="card-title">Average Quality Score</div>
                    <div class="card-value tooltip" data-tooltip="Overall data completeness percentage">{{ avg_quality|default:0 }}%</div>
                    <div class="card-subtitle">Data completeness and accuracy metric</div>
                    <div class="progress-container">
                        <div class="progress-bar {% if avg_quality >= 80 %}progress-excellent{% elif avg_quality >= 60 %}progress-good{% else %}progress-poor{% endif %}" style="width: {{ avg_quality|default:0 }}%;"></div>
                    </div>
                    <div class="card-metric">
                        <span class="metric-label">Quality Status</span>
                        <span class="metric-value">
                            <span class="status-indicator {% if avg_quality >= 80 %}status-excellent{% elif avg_quality >= 60 %}status-good{% else %}status-poor{% endif %}"></span>
                            {% if avg_quality >= 80 %}Excellent{% elif avg_quality >= 60 %}Good{% else %}Needs Improvement{% endif %}
                        </span>
                    </div>
                </div>

                <div class="enhanced-card card-overview clickable-card" data-metric="missing_contacts" tabindex="0" role="article" aria-label="Missing Contacts Statistics">
                    <div class="card-header">
                        <div class="card-icon animated-icon danger-gradient">❌</div>
                        <div class="card-badge">Alert</div>
                    </div>
                    <div class="card-title">Unreachable PNRs</div>
                    <div class="card-value tooltip" data-tooltip="PNRs without any contact information">{{ missing_contacts|default:0 }}</div>
                    <div class="card-subtitle">Passengers without contact details</div>
                    <div class="progress-container">
                        <div class="progress-bar progress-poor" style="width: {% if total_pnrs %}{% widthratio missing_contacts total_pnrs 100 %}%{% else %}0%{% endif %};"></div>
                    </div>
                    <div class="card-metric">
                        <span class="metric-label">Impact Level</span>
                        <span class="metric-value">{% if missing_contacts > 100 %}🔴 High{% elif missing_contacts > 50 %}🟡 Medium{% else %}🟢 Low{% endif %}</span>
                    </div>
                </div>

                <div class="enhanced-card card-overview clickable-card" data-metric="wrongly_placed_contacts" tabindex="0" role="article" aria-label="Misplaced Contacts Statistics">
                    <div class="card-header">
                        <div class="card-icon animated-icon warning-gradient">🔄</div>
                        <div class="card-badge">Data Issue</div>
                    </div>
                    <div class="card-title">Misplaced Contacts</div>
                    <div class="card-value tooltip" data-tooltip="Contacts in wrong fields (email in phone field, etc.)">{{ wrongly_placed_contacts|default:0 }}</div>
                    <div class="card-subtitle">Email in phone field, phone in email field</div>
                    <div class="progress-container">
                        <div class="progress-bar progress-good" style="width: {% if total_pnrs %}{% widthratio wrongly_placed_contacts total_pnrs 100 %}%{% else %}0%{% endif %};"></div>
                    </div>
                    <div class="card-metric">
                        <span class="metric-label">Fix Priority</span>
                        <span class="metric-value">📋 Medium</span>
                    </div>
                </div>

                <div class="enhanced-card card-overview clickable-card" data-metric="wrong_format_contacts" tabindex="0" role="article" aria-label="Wrong Format Contacts Statistics">
                    <div class="card-header">
                        <div class="card-icon animated-icon danger-gradient">✍️</div>
                        <div class="card-badge">Format Error</div>
                    </div>
                    <div class="card-title">Invalid Format Contacts</div>
                    <div class="card-value tooltip" data-tooltip="Contacts with incorrect email or phone format">{{ wrong_format_contacts|default:0 }}</div>
                    <div class="card-subtitle">Invalid email addresses and phone numbers</div>
                    <div class="progress-container">
                        <div class="progress-bar progress-poor" style="width: {% if total_pnrs %}{% widthratio wrong_format_contacts total_pnrs 100 %}%{% else %}0%{% endif %};"></div>
                    </div>
                    <div class="card-metric">
                        <span class="metric-label">Validation Status</span>
                        <span class="metric-value">🔍 Failed</span>
                    </div>
                </div>
            </div>
            <div class="table-container">
                <h3>Recent Bookings Sample</h3>
                <table class="data-table" id="bookingsTable">
                    <thead>
                        <tr>
                            <th>PNR</th>
                            <th>Delivery System</th>
                            <th>Office ID</th>
                            <th class="sortable" data-column-index="3">Quality Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pnr in pnrs|slice:":10" %}
                        <tr>
                            <td>{{ pnr.control_number }}</td>
                            <td>{{ pnr.delivery_system_company|default:"-" }}</td>
                            <td>{{ pnr.office_id|default:"-" }}</td>
                            <td><span class="{% if pnr.quality_score >= 80 %}text-success{% elif pnr.quality_score >= 60 %}text-warning{% else %}text-danger{% endif %}">{{ pnr.quality_score }}%</span></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Delivery System Performance Section -->
        <div id="delivery-systems" class="content-section">
            <div class="enhanced-card card-delivery card-spacing">
                <div class="card-header">
                    <div class="card-icon success-gradient">🌐</div>
                    <div class="card-badge">Performance</div>
                </div>
                <div class="card-title">Delivery Systems Performance</div>
                <div class="card-subtitle">Top 10 systems ranked by booking volume with quality scores and market share analysis</div>
                <div class="card-metric">
                    <span class="metric-label">Analysis Type</span>
                    <span class="metric-value">📊 Volume & Quality</span>
                </div>
                <div class="card-metric">
                    <span class="metric-label">Ranking Criteria</span>
                    <span class="metric-value">📈 Booking Volume</span>
                </div>
                <button class="card-button" onclick="document.getElementById('delivery-system-grid').scrollIntoView({behavior: 'smooth'})">View Analysis</button>
            </div>
            <div class="enhanced-card">
                <canvas id="deliverySystemChart" height="120"></canvas>
            </div>
        </div>

        <!-- Missing Elements Section -->
        <div id="elements" class="content-section">
            <div class="enhanced-card card-elements card-spacing">
                <div class="card-header">
                    <div class="card-icon warning-gradient">📋</div>
                    <div class="card-badge">Analysis</div>
                </div>
                <div class="card-title">Data Elements Completeness</div>
                <div class="card-subtitle">Analysis of missing critical booking elements across all PNRs</div>
                <div class="card-metric">
                    <span class="metric-label">Elements Tracked</span>
                    <span class="metric-value">5 Critical Fields</span>
                </div>
                <div class="card-metric">
                    <span class="metric-label">Completion Target</span>
                    <span class="metric-value">🎯 80%+</span>
                </div>
                <button class="card-button" onclick="document.getElementById('elements-grid').scrollIntoView({behavior: 'smooth'})">View Details</button>
            </div>
            <div class="elements-grid" id="elements-grid">
                <div class="element-chart">
                    <canvas id="emailChart" width="250" height="250"></canvas>
                    <div class="element-label">📧 Email</div>
                </div>
                <div class="element-chart">
                    <canvas id="phoneChart" width="250" height="250"></canvas>
                    <div class="element-label">📞 Phone</div>
                </div>
                <div class="element-chart">
                    <canvas id="ffChart" width="250" height="250"></canvas>
                    <div class="element-label">✈️ FF#</div>
                </div>
                <div class="element-chart">
                    <canvas id="mealChart" width="250" height="250"></canvas>
                    <div class="element-label">🍽️ Meal</div>
                </div>
                <div class="element-chart">
                    <canvas id="seatChart" width="250" height="250"></canvas>
                    <div class="element-label">💺 Seat</div>
                </div>
            </div>
        </div>

        <!-- Office Performance Section -->
        <div id="offices" class="content-section">
            <div class="enhanced-card card-offices card-spacing">
                <div class="card-header">
                    <div class="card-icon info-gradient">🏢</div>
                    <div class="card-badge">Performance</div>
                </div>
                <div class="card-title">Top 15 Office Performance Comparison</div>
                <div class="card-subtitle">Horizontal bar chart showing quality scores and booking volumes</div>
                <div class="card-metric">
                    <span class="metric-label">Offices Analyzed</span>
                    <span class="metric-value">{{ office_stats|length }} Locations</span>
                </div>
                <div class="card-metric">
                    <span class="metric-label">Visualization</span>
                    <span class="metric-value">📊 Bar Chart</span>
                </div>
            </div>
            <div class="enhanced-card">
                <div class="office-chart-container">
                    <canvas id="officePerformanceChart" height="350"></canvas>
                </div>
            </div>
            <div class="enhanced-card table-card">
                <h4 style="margin-bottom: 15px; color: var(--text-primary);">📋 Detailed Office Rankings</h4>
                <table class="heatmap-table" id="officeTable">
                    <thead>
                        <tr>
                            <th>Office</th>
                            <th class="sortable" data-column-index="1">Quality Score</th>
                            <th class="sortable" data-column-index="2">Volume</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for stat in office_stats|slice:":15" %}
                        <tr class="{% if stat.avg_quality >= 80 %}performance-high{% elif stat.avg_quality >= 60 %}performance-medium{% else %}performance-low{% endif %}">
                            <td><strong>{{ stat.office_name }}</strong><br><small>{{ stat.office_id }}</small></td>
                            <td class="score-cell">{{ stat.avg_quality|floatformat:1 }}%</td>
                            <td>{{ stat.total }}</td>
                            <td>{% if stat.avg_quality >= 80 %}🟢{% elif stat.avg_quality >= 60 %}🟡{% else %}🔴{% endif %}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Quality Distribution Section -->
        <div id="quality" class="content-section">
            <div class="enhanced-card card-quality card-spacing">
                <div class="card-header">
                    <div class="card-icon purple-gradient">📈</div>
                    <div class="card-badge">Distribution</div>
                </div>
                <div class="card-title">Quality Score Distribution</div>
                <div class="card-subtitle">Breakdown of PNRs across different quality score ranges</div>
                <div class="card-metric">
                    <span class="metric-label">Score Ranges</span>
                    <span class="metric-value">5 Categories</span>
                </div>
                <div class="card-metric">
                    <span class="metric-label">Target Range</span>
                    <span class="metric-value">🎯 81-100%</span>
                </div>
                <button class="card-button" onclick="document.getElementById('qualityHistogram').scrollIntoView({behavior: 'smooth'})">View Distribution</button>
            </div>
            <div class="enhanced-card card-spacing">
                <div class="histogram-header">
                    <h3 class="histogram-title">📊 Quality Score Distribution Spectrum</h3>
                    <p class="histogram-subtitle">Journey from Critical to Excellence - Where does your data stand?</p>
                </div>
                <div class="quality-histogram" id="qualityHistogram">
                    <div class="histogram-bar critical" data-count="{{ critical_count|default:0 }}">
                        <div class="bar-fill"></div>
                        <div class="bar-text">{{ critical_count|default:0 }} PNRs</div>
                        <div class="x-axis-label">
                            <div class="axis-category">Critical</div>
                            <div class="axis-range">0-20%</div>
                        </div>
                    </div>
                    <div class="histogram-bar poor" data-count="{{ poor_count|default:0 }}">
                        <div class="bar-fill"></div>
                        <div class="bar-text">{{ poor_count|default:0 }} PNRs</div>
                        <div class="x-axis-label">
                            <div class="axis-category">Poor</div>
                            <div class="axis-range">21-40%</div>
                        </div>
                    </div>
                    <div class="histogram-bar fair" data-count="{{ fair_count|default:0 }}">
                        <div class="bar-fill"></div>
                        <div class="bar-text">{{ fair_count|default:0 }} PNRs</div>
                        <div class="x-axis-label">
                            <div class="axis-category">Fair</div>
                            <div class="axis-range">41-60%</div>
                        </div>
                    </div>
                    <div class="histogram-bar good" data-count="{{ good_count|default:0 }}">
                        <div class="bar-fill"></div>
                        <div class="bar-text">{{ good_count|default:0 }} PNRs</div>
                        <div class="x-axis-label">
                            <div class="axis-category">Good</div>
                            <div class="axis-range">61-80%</div>
                        </div>
                    </div>
                    <div class="histogram-bar excellent" data-count="{{ excellent_count|default:0 }}">
                        <div class="bar-fill"></div>
                        <div class="bar-text">{{ excellent_count|default:0 }} PNRs</div>
                        <div class="x-axis-label">
                            <div class="axis-category">Excellent</div>
                            <div class="axis-range">81-100%</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="enhanced-card card-quality">
                <div class="card-header">
                    <div class="card-icon purple-gradient">📅</div>
                    <div class="card-badge">Trend</div>
                </div>
                <div class="card-title">Quality Score Trend Analysis</div>
                <div class="card-subtitle">Average daily quality score based on booking creation date</div>
                <div class="card-metric">
                    <span class="metric-label">Time Period</span>
                    <span class="metric-value">
                        <select id="trend-days-selector" onchange="initializeQualityTrendChart()" class="trend-selector">
                            <option value="7">Last 7 Days</option>
                            <option value="30">Last 30 Days</option>
                            <option value="90" selected>Last 90 Days</option>
                        </select>
                    </span>
                </div>
                <div class="chart-container trend-chart">
                    <canvas id="qualityTrendChart" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Export Section -->
        <div id="export" class="content-section">
            <div class="enhanced-stats-grid">
                <div class="enhanced-card card-export" tabindex="0" role="article" aria-label="Export All Data">
                    <div class="card-header">
                        <div class="card-icon info-gradient">📊</div>
                        <div class="card-badge">Complete</div>
                    </div>
                    <div class="card-title">All Booking Data</div>
                    <div class="card-subtitle">Complete dataset with all PNRs, quality scores, and contact information</div>
                    <div class="card-metric">
                        <span class="metric-label">Records</span>
                        <span class="metric-value">{{ total_pnrs|default:0 }} PNRs</span>
                    </div>
                    <div class="card-metric">
                        <span class="metric-label">Format</span>
                        <span class="metric-value">📋 Excel (.xlsx)</span>
                    </div>
                    <a href="#" class="export-link card-button" data-export-type="all">Download All Data</a>
                </div>

                <div class="enhanced-card card-export" tabindex="0" role="article" aria-label="Export No Contacts Data">
                    <div class="card-header">
                        <div class="card-icon danger-gradient">📞</div>
                        <div class="card-badge">Missing</div>
                    </div>
                    <div class="card-title">No Contact Information</div>
                    <div class="card-subtitle">PNRs without any phone or email contact details</div>
                    <div class="card-metric">
                        <span class="metric-label">Records</span>
                        <span class="metric-value">{{ missing_contacts|default:0 }} PNRs</span>
                    </div>
                    <div class="card-metric">
                        <span class="metric-label">Priority</span>
                        <span class="metric-value">🔴 High</span>
                    </div>
                    <a href="#" class="export-link card-button" data-export-type="no_contacts">Download Missing Contacts</a>
                </div>

                <div class="enhanced-card card-export" tabindex="0" role="article" aria-label="Export Low Quality Data">
                    <div class="card-header">
                        <div class="card-icon warning-gradient">⚠️</div>
                        <div class="card-badge">Low Quality</div>
                    </div>
                    <div class="card-title">Low Quality Bookings</div>
                    <div class="card-subtitle">PNRs with quality scores below 60% requiring attention</div>
                    <div class="card-metric">
                        <span class="metric-label">Threshold</span>
                        <span class="metric-value">< 60% Quality</span>
                    </div>
                    <div class="card-metric">
                        <span class="metric-label">Action</span>
                        <span class="metric-value">🔧 Review Required</span>
                    </div>
                    <a href="#" class="export-link card-button" data-export-type="low_quality">Download Low Quality</a>
                </div>

                <div class="enhanced-card card-export" tabindex="0" role="article" aria-label="Export High Quality Data">
                    <div class="card-header">
                        <div class="card-icon success-gradient">⭐</div>
                        <div class="card-badge">Excellent</div>
                    </div>
                    <div class="card-title">High Quality Bookings</div>
                    <div class="card-subtitle">PNRs with quality scores above 80% - best practices examples</div>
                    <div class="card-metric">
                        <span class="metric-label">Threshold</span>
                        <span class="metric-value">> 80% Quality</span>
                    </div>
                    <div class="card-metric">
                        <span class="metric-label">Status</span>
                        <span class="metric-value">✅ Excellent</span>
                    </div>
                    <a href="#" class="export-link card-button" data-export-type="high_quality">Download High Quality</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Detailed Data -->
    <div id="data-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <h3 id="modal-title">Detailed Data</h3>
                    <p id="modal-subtitle" class="modal-subtitle"></p>
                </div>
                <button id="modal-export-btn" class="filter-btn">📤 Export to Excel</button>
                <button id="modal-close-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-controls">
                    <div id="modal-dynamic-filters" style="flex-grow: 1;"></div>
                </div>
                <div class="modal-table-container">
                    <table class="data-table" id="modal-table">
                        <thead>
                            <tr>
                                <!-- Headers will be populated by JS -->
                            </tr>
                        </thead>
                        <tbody id="modal-table-body">
                            <!-- Rows will be populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script id="dashboard-data" type="application/json">
        {{ dashboard_data_json|safe }}
    </script>
    <script>
        const data = JSON.parse(document.getElementById('dashboard-data').textContent);
        initDashboard(data);
    </script>
</body>
</html>